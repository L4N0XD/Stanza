{% include "header.html" %}

<button id="startProgress"  onclick="startProgressBar()" style="display: none;">comecar</button>
<form  method="POST" action="{% url 'upload' %}" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="input-group mb-3" style="width: 600px; height: 100px; margin: auto; margin-top: 15%;">
        <div id="divProgress" class="progress" role="progressbar" aria-label="Basic example" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 500px; display: none; border-radius: 10px;" >
            <div class="progress-bar"  id="progresso" style="width: 0%; position: relative; z-index: 0; background: orange;"></div>
            <p id="text_progress" style="position: absolute; z-index: 1; text-align: center; left: 42%; transform: translateX(-50%); color: orange"></p>
        </div>
        
            <div class="form-group "style="width:500px; height:40px; display:flex;" id='uploadForm'>
                <input type="file" class="form-control" id="arquivo" name="arquivo">
                <button id="startUpload" class="btn btn-outline-success" type="submit">Upload</button>
            </div>
        </div>
    </form>
    
    <script>
    document.querySelector('#titulo').textContent = 'Upload de solicitação de compra'
    const startUpload = document.querySelector('#startUpload')
    const startProgress = document.querySelector('#startProgress')
    const divProgress = document.querySelector('#divProgress')
    startUpload.addEventListener('click', () => startProgress.click())
  function startProgressBar() {
      var progressBar = document.querySelector('#progresso')
      var textProgress = document.querySelector('#text_progress')
      var formUpload = document.querySelector('#uploadForm')
      formUpload.style.display = 'none'
      divProgress.style.display = 'flex'
      var width = 0;
      var index = 0;
      var id = setInterval(frame, 400);
      const loadTexts = ["Carregando...","Por favor, aguarde...","Lendo o arquivo...","Processando os dados...","Carregando informações...","Quase lá...","Finalizando a leitura...", "Pronto!"];
  
      
      function frame() {
        if (width >= 100) {
          clearInterval(id);
          textProgress.textContent = 'Redirecionando...'
        } else {
            if (width % 14 == 0) {
              textProgress.textContent = loadTexts[index];
              index++
            }
            if (width == 42) {
                textProgress.style.color = 'white';
            }
          width++
          progressBar.style.width = width + '%';
        }
      }
  }
      </script>
</body>
</html>